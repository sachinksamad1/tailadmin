<aside
  [ngClass]="{
    'lg:w-[290px]': isExpanded() || isMobileOpen() || isHovered(),
    'lg:w-[90px]': !isExpanded() && !isHovered(),
    'translate-x-0 w-[290px]': isMobileOpen(),
    '-translate-x-full': !isMobileOpen(),
    'lg:translate-x-0': true
  }"
  class="fixed mt-16 flex flex-col lg:mt-0 top-0 px-5 left-0 bg-white dark:bg-gray-900 dark:border-gray-800 text-gray-900 h-screen transition-all duration-300 ease-in-out z-99999 border-r border-gray-200"
  (mouseenter)="onMouseEnter()"
  (mouseleave)="onMouseLeave()"
>
  <div
    class="py-8 flex"
    [ngClass]="!isExpanded() && !isHovered() ? 'lg:justify-center' : 'justify-start'"
  >
    <a routerLink="/">
      @if (isExpanded() || isHovered() || isMobileOpen()) {
        <img
          class="dark:hidden"
          src="/images/logo/logo.svg"
          alt="Logo"
          width="150"
          height="40"
        />
        <img
          class="hidden dark:block"
          src="/images/logo/logo-dark.svg"
          alt="Logo"
          width="150"
          height="40"
        />
      } @else {
        <img
          src="/images/logo/logo-icon.svg"
          alt="Logo"
          width="32"
          height="32"
        />
      }
    </a>
  </div>

  <div class="flex flex-col overflow-y-auto duration-300 ease-linear no-scrollbar">
    <nav class="mb-6">
      <div class="flex flex-col gap-4">
        
        @for (menuGroup of menuGroups; track menuGroup.title; let groupIndex = $index) {
          <div>
            <h2
              class="mb-4 text-xs uppercase flex leading-[20px] text-gray-400"
              [ngClass]="!isExpanded() && !isHovered() ? 'lg:justify-center' : 'justify-start'"
            >
              @if (isExpanded() || isHovered() || isMobileOpen()) {
                {{ menuGroup.title }}
              } @else {
                <ng-container *ngComponentOutlet="horizontalDotsIcon"></ng-container>
              }
            </h2>

            <ul class="flex flex-col gap-4">
              @for (item of menuGroup.items; track item.name; let itemIndex = $index) {
                <li>
                  @if (item.subItems) {
                    <button
                      class="menu-item group w-full"
                      [ngClass]="{
                        'menu-item-active': isSubmenuOpen(groupIndex, itemIndex),
                        'menu-item-inactive': !isSubmenuOpen(groupIndex, itemIndex),
                        'lg:justify-center': !isExpanded() && !isHovered(),
                        'lg:justify-start': isExpanded() || isHovered()
                      }"
                      (click)="handleToggleSubmenu(groupIndex, itemIndex)"
                    >
                      <span
                        [ngClass]="isSubmenuOpen(groupIndex, itemIndex) ? 'menu-item-icon-active' : 'menu-item-icon-inactive'"
                      >
                        <ng-container *ngComponentOutlet="item.icon"></ng-container>
                      </span>

                      @if (isExpanded() || isHovered() || isMobileOpen()) {
                        <span class="menu-item-text">{{ item.name }}</span>
                        
                        <span 
                           class="ml-auto w-5 h-5 transition-transform duration-200"
                           [ngClass]="{ 'rotate-180 text-brand-500': isSubmenuOpen(groupIndex, itemIndex) }"
                        >
                            <ng-container *ngComponentOutlet="chevronDownIcon"></ng-container>
                        </span>
                      }
                    </button>

                    @if (isSubmenuOpen(groupIndex, itemIndex) && (isExpanded() || isHovered() || isMobileOpen())) {
                      <div [@slideInOut]>
                        <ul class="mt-2 space-y-1 ml-9">
                          @for (subItem of item.subItems; track subItem.name) {
                            <li>
                              <a
                                [routerLink]="subItem.path"
                                class="menu-dropdown-item"
                                [ngClass]="{
                                  'menu-dropdown-item-active': isActive(subItem.path),
                                  'menu-dropdown-item-inactive': !isActive(subItem.path)
                                }"
                              >
                                {{ subItem.name }}
                                <span class="flex items-center gap-1 ml-auto">
                                  @if (subItem.new) {
                                    <span
                                      class="menu-dropdown-badge"
                                      [ngClass]="{
                                        'menu-dropdown-badge-active': isActive(subItem.path),
                                        'menu-dropdown-badge-inactive': !isActive(subItem.path)
                                      }"
                                    >new</span>
                                  }
                                  @if (subItem.pro) {
                                    <span
                                      class="menu-dropdown-badge"
                                      [ngClass]="{
                                        'menu-dropdown-badge-active': isActive(subItem.path),
                                        'menu-dropdown-badge-inactive': !isActive(subItem.path)
                                      }"
                                    >pro</span>
                                  }
                                </span>
                              </a>
                            </li>
                          }
                        </ul>
                      </div>
                    }
                  } 
                  
                  @else if (item.path) {
                    <a
                      [routerLink]="item.path"
                      class="menu-item group"
                      [ngClass]="{
                        'menu-item-active': isActive(item.path!),
                        'menu-item-inactive': !isActive(item.path!)
                      }"
                    >
                      <span
                        [ngClass]="isActive(item.path!) ? 'menu-item-icon-active' : 'menu-item-icon-inactive'"
                      >
                         <ng-container *ngComponentOutlet="item.icon"></ng-container>
                      </span>

                      @if (isExpanded() || isHovered() || isMobileOpen()) {
                        <span class="menu-item-text">{{ item.name }}</span>
                      }
                    </a>
                  }
                </li>
              }
            </ul>
          </div>
        }
      </div>
    </nav>

    @if (isExpanded() || isHovered() || isMobileOpen()) {
      <app-sidebar-widget />
    }
  </div>
</aside>